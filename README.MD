# Лабораторная 5

## Отрабатываемый материал

**Реактивное межсервисное взаимодействие, Kafka**

## Задача

**Что сделано:**
- **Интегрировал сервис из Лабораторной 4 с сервисом обработки заказов через Kafka:**
  - Реализовал публикацию сообщений в топик `order_creation` при создании заказа и переводе заказа в статус `processing`.
  - Настроил чтение из топика `order_processing` и корректную обработку поступающих событий, включая фиксацию жизненного цикла заказа и обработку неуспешных исходов (в таком случае заказ переводится в статус `cancelled`).
- **Изменил логику отмены заказов:**
  Теперь отмена заказа возможна только в статусе `created`, чтобы обеспечить корректную бизнес-логику, согласованную с событиями внешнего сервиса.
- **Обновил логику завершения заказа:**
  Завершение (`completed`) заказа теперь происходит только после получения соответствующего успешного события доставки из `order_processing`, убрав возможность перевести заказ в `completed` ручным вызовом.

## Сценарий тестирования

**Что сделано:**
- Организовал сквозной сценарий:
  1. Создание заказа в вашем сервисе → публикуется сообщение в `order_creation`.
  2. Перевод заказа в статус `processing` → публикуется соответствующее сообщение в `order_creation`.
  3. Получение событий согласования, упаковки и доставки заказа от сервиса обработки заказов через `order_processing`.
  4. Обработка неуспешных исходов (отмена заказа).
  5. Обработка успешных завершений отдельных стадий, вплоть до успешного завершения доставки, приводящей к статусу `completed`.

## Нефункциональные требования

**Что сделано:**
- **Абстракции для взаимодействия с Kafka:**
  - Разработал интерфейс для продюсера сообщений и отдельный интерфейс для потребителей с батчовой обработкой.
  - Реализовал отдельный фоновый сервис для чтения и обработки сообщений из Kafka.
  - Вынес продюсер и консюмер в отдельный проект с абстракциями и методами расширения для DI.
  - Все параметры Kafka (адрес подключения, названия топиков, размеры батчей) сделаны параметризуемыми через Options.
- **Архитектурная гибкость:**
  - Перенёс или адаптировал код, репозитории и сервисы в папку `lab-4`, не нарушая их целостность.
  - Продюсер и консюмер не зависят от конкретных топиков и не привязаны к реализации `Itmo.Dev.Platform.Kafka`.
- **REST-конвенции для гейтвея:**
  - Все новые и существующие HTTP эндпоинты в гейтвее приведены к REST-стилю, документированы с помощью Swagger, включая описание полиморфных моделей.
